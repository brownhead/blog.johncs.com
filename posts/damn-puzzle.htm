<!DOCTYPE html> <html> <head> <title>John CS - Solving a wooden puzzle</title> <meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta name=description content="Last week a mysterious double-sided puzzle appeared next to the kitchen at Khan Academy."> <meta name=viewport content="width=device-width, initial-scale=1.0"> <!--inject:head:css--> <style>#post-title,h2{font-weight:400}#comments,#draft-bar,#end-bits,#top-header{text-align:center}.c,.c1,.cm,.cs,.ge{font-style:italic}#draft-bar{position:fixed;bottom:0;left:0;right:0;background-color:#EEA;padding:1em}#post-body{margin:0 auto;line-height:1.5;max-width:50em}#post-body img,#top-header,table.footnote:first-of-type{margin-top:2em}#top-header{margin-bottom:4em}#post-title{font-size:2em;line-height:1.5;letter-spacing:.08em;margin-bottom:.4em}h2{letter-spacing:.07em}#post-body img{max-width:100%;margin-bottom:2em}table.footnote{font-size:.8em}pre,tt{font-family:'Courier New',Courier,'Lucida Sans Typewriter','Lucida Typewriter',monospace}pre{padding-left:1em}.red-bold{color:red;font-weight:700}#end-bits{margin:3em 0 1em;font-size:1.25em}#comments{color:#AAA}body{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background-color:#FEFEFE;color:#161616;padding:2em;font-size:16px}@media (min-width:1500px){body{font-size:19px}}@media (max-width:1000px){body{font-size:15px}}b,strong{font-weight:600}a{text-decoration:none;color:#3b8bba}a:hover{text-decoration:underline}#content .pure-form fieldset,#content .pure-form legend{border-bottom:none}a.pure-button-primary,button.pure-button-primary{background-color:#5CADB5;font-weight:600}.cp,.cs,.gs,.k,.kc,.kd,.kn,.kp,.kr,.kt,.nc,.ne,.nf,.o,.ow{font-weight:700}.faded{opacity:.7}.align-center{display:block;margin:0 auto}.hll{background-color:#ffc}.c{color:#998}.err{color:#a61717;background-color:#e3d2d2}.cm{color:#998}.cp{color:#999}.c1{color:#998}.cs{color:#999}.gd{color:#000;background-color:#fdd}.gr{color:#a00}.gh{color:#999}.gi{color:#000;background-color:#dfd}.go{color:#888}.gp{color:#555}.gu{color:#aaa}.gt{color:#a00}.kt{color:#458}.m{color:#099}.s{color:#b84}.na{color:teal}.nb{color:#999}.nc{color:#458}.no{color:teal}.ni{color:purple}.ne,.nf{color:#900}.nn{color:#555}.nt{color:navy}.nv{color:teal}.w{color:#bbb}.mf,.mh,.mi,.mo{color:#099}.s2,.sb,.sc,.sd,.se,.sh,.si,.sx{color:#b84}.sr{color:olive}.s1,.ss{color:#b84}.bp{color:#999}.vc,.vg,.vi{color:teal}.il{color:#099}</style> <!--endinject--> </head> <body id=post-page> <a href="javascript: document.getElementById('draft-bar').remove()" id=draft-bar> This is a draft, please don't share it (click to hide) </a> <header id=top-header> <h1 id=post-title> <a href="/">John CS</a>: Solving a wooden puzzle </h1> <div id=post-metadata class=faded> Posted April 27, 2015 </div> </header> <div id=post-body> <div class=document> <p>Last week a mysterious double-sided puzzle appeared at <a class="reference external" href="https://www.khanacademy.org/">Khan Academy</a>.</p> <a class="reference external image-reference" href=/images/mysterious-puzzle.jpg><img alt="A picture of the mysterious puzzle" class=align-center src=/images/mysterious-puzzle.jpg style="width: 75%;"></a> <p>To solve the puzzle you must fit all four pieces inside the recessed area (the pieces will not entirely fill the area). We found a solution to the easy side after only a few days <a class=footnote-reference href=#easy-solution id=id1>[1]</a> but nobody could get close to solving the hard side. So five of us began writing our own solvers.</p> <p>The first question each of us faced was how to represent the positions of the pieces. We were able to lay down a triangular grid on top of each side, but how should the cells be addressed?</p> <p>Each of us came up with our own answer to this question <a class=footnote-reference href=#such-coordinates id=id2>[2]</a>. I decided to use a coordinate system that used two perpendicular axes, with the origin at the bottom left.</p> <img alt="The triangular grid" class=align-center src=/images/triangular-grid.png style="width: 75%;"> <a class="reference external image-reference" href=/images/johns-coordinates.png><img alt="My coordinate system" class=align-center src=/images/johns-coordinates.png style="width: 75%;"></a> <p>I had a problem though. Once I manually input a piece into my coordinate system, I needed to be able to rotate and reflect that piece into 12 different alignments. Reflection was easy, but despite my best efforts, I couldn't figure out how to rotate the pieces once they were placed into my grid.</p> <p>After smashing my head against the problem for an hour and getting nowhere, I gave up <a class=footnote-reference href=#emily-rotation id=id3>[3]</a>. I instead decided to manually input each of the three rotations necessary for each piece (all the other alignments could be expressed as reflections of those rotations).</p> <p>Now I just had to write the logic to try every possible placement of the pieces.</p> <p>By this time, Ben Eater's solver was done and ticking away. <a class="reference external" href=https://www.khanacademy.org/computer-programming/spin-off-of-puzzle/4900481558249472>His solver</a> didn't do any pruning of the search space though (and took some time to check each placement), so he estimated that the solver would finish in around 2 years. I felt good about my chances of finding a solution before then.</p> <img alt="Ben Eater's solver" class=align-center src=/images/eaters-solver.gif> <p>To try and be a little faster I added in some logic to prune large parts of the search space where possible. This worked by laying down a piece at a time, and only trying the other ones if there were no collisions.</p> <p>For example, first my program would lay down Piece A somewhere. If Piece A collided with a wall, my program would not try laying down Piece B yet, but would instead move Piece A somewhere else. Similarily, once it came time to lay down</p> <p>This ended up working well and soon I had <a class="reference external" href=https://github.com/brownhead/damn-puzzle/blob/master/boom.js>a solver</a> that could brute force the puzzle in less than a minute.</p> <img alt="My solver" class=align-center src=/images/solver.gif style="width: 50%;"> <p>Emily finished <a class="reference external" href=https://github.com/xymostech/wood-puzzle/blob/master/src/Main.hs>her solver</a> around the same time and we were able to confirm our results. <strong>The hard side of the puzzle was unsolvable</strong>.</p> <p>Clearly there was a very evil puzzle master in our ranks.</p> <img alt="An evil kitten" class=align-center src=/images/evil-kitty.gif style="width: 50%;"> <p><a class="reference external" href="http://jamie-wong.com/">Jamie Wong</a> readily admitted to bringing in the puzzle (though he didn't tell us where he got it). Despite the staggering proof to the contrary though, he was adamant that a solution existed. He said our solvers all shared a fatal flaw.</p> <p>After a few hints, Emily and I did find the answer <a class=footnote-reference href=#hard-solution id=id4>[4]</a>. Which was good, because none of us had gotten any work done for a little while and we were starting to feel guilty.</p> <table class="docutils footnote" frame=void id=easy-solution rules=none> <colgroup><col class=label><col></colgroup> <tbody valign=top> <tr><td class=label><a class=fn-backref href=#id1>[1]</a></td><td>If you want to spoil it for yourself, here is <a class="reference external" href=/images/easy-solved.jpg>a picture of the solved easy side</a>.</td></tr> </tbody> </table> <table class="docutils footnote" frame=void id=such-coordinates rules=none> <colgroup><col class=label><col></colgroup> <tbody valign=top> <tr><td class=label><a class=fn-backref href=#id2>[2]</a></td><td>Ben Eater decided to side-step the issue by drawing the shapes directly onto the screen. Cam Christensen came up with a coordinate system with two axes that formed a 60° angle and he convinced Emily Eisenberg to use the same system. Justin Helps used a screen-based coordinate system like Ben Eater, but tracked all three vertices of each triangle.</td></tr> </tbody> </table> <table class="docutils footnote" frame=void id=emily-rotation rules=none> <colgroup><col class=label><col></colgroup> <tbody valign=top> <tr><td class=label><a class=fn-backref href=#id3>[3]</a></td><td><a class="reference external" href=https://github.com/xymostech/wood-puzzle/blob/f7ea685855c06531debcc9e6105451c934a00cde/src/Main.hs#L35>Emily was actually able to figure out rotation</a> (though her coordinate system was different in that the axes formed a 60° angle).</td></tr> </tbody> </table> <table class="docutils footnote" frame=void id=hard-solution rules=none> <colgroup><col class=label><col></colgroup> <tbody valign=top> <tr><td class=label><a class=fn-backref href=#id4>[4]</a></td><td>You don't really want me to give you the answer do you? That would be boring.</td></tr> </tbody> </table> </div> </div> <div id=end-bits> <a href="/">see all posts</a> - <a href=/rss.xml>subscribe with RSS</a> </div> <div id=comments> (comments are temporarily unavailable) </div> </body> </html> 