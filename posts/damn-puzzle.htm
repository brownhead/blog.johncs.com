<!DOCTYPE html>
<html>
<head>
    <title>John CS - Solving a wooden puzzle</title>

    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,800&subset=latin" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/pygments.css">
</head>
<body id="post-page">
    <a href="javascript: document.getElementById('draft-bar').remove()" id="draft-bar">
        This is a draft, please don't share it (click to hide)
    </a>
    <header id="top-header">
        <div id="post-title">
            <a id="site-title" href="/">John CS</a> &rarr; Solving a wooden puzzle
        </div>
        <div id="post-metadata" class="faded">
            Posted April 27, 2015 (<a href="/rss.xml">RSS</a>)
        </div>
    </header>
    <div id="post-body">
        <div class="document">
<p>Last week a mysterious double-sided puzzle appeared at <a class="reference external" href="https://www.khanacademy.org/">Khan Academy</a>.</p>
<a class="reference external image-reference" href="/images/mysterious-puzzle.jpg"><img alt="A picture of the mysterious puzzle" class="align-center" src="/images/mysterious-puzzle.jpg" style="width: 75%;" /></a>
<p>To solve the puzzle you must fit all four pieces inside the recessed area (the pieces will not entirely fill the area). After a few days we found a solution to the easy side <a class="footnote-reference" href="#easy-solution" id="id1">[1]</a> but nobody could figure out the hard one. So five of us began writing our own solvers.</p>
<p>The first question each of us faced was how to represent the positions of the pieces. We were able to lay down a triangular grid on top of each side, but how should the cells be addressed?</p>
<p>Each of us came up with our own answer to this question <a class="footnote-reference" href="#such-coordinates" id="id2">[2]</a>. I decided to use a coordinate system that used two perpendicular axes, with the origin at the bottom left.</p>
<img alt="The triangular grid" class="align-center" src="/images/triangular-grid.png" style="width: 75%;" />
<a class="reference external image-reference" href="/images/johns-coordinates.png"><img alt="My coordinate system" class="align-center" src="/images/johns-coordinates.png" style="width: 75%;" /></a>
<p>I had a problem though, I couldn't figure out how to rotate the pieces once they were placed into my grid. After smashing my head against the problem for awhile and getting nowhere, I gave up and manually input each rotation. This ended up being three rotations per piece (the remaining alignments could be expressed as reflections of one of the rotations).</p>
<p>Now I had to actually write the logic to try every possible configuration.</p>
<p>By this time, Ben Eater's solver was done and ticking away. <a class="reference external" href="https://www.khanacademy.org/computer-programming/spin-off-of-puzzle/4900481558249472">His solver</a> didn't do any pruning of the search space though (and took some time to check each configuration), so he estimated that the solver would finish in around 2 years. I felt good about my chances of finding a solution before then.</p>
<img alt="Ben Eater's solver" class="align-center" src="/images/eaters-solver.gif" />
<p>To try and be a little faster I added in some logic to prune large parts of the search space where possible. This worked by laying down a piece at a time, and only trying the other ones if there were no collisions.</p>
<p>For example, first my program would lay down Piece A somewhere. If Piece A collided with a wall, my program would not try laying down Piece B yet, but would instead move Piece A somewhere else.</p>
<p>This ended up working well and soon I had <a class="reference external" href="https://github.com/brownhead/damn-puzzle/blob/master/boom.js">a solver</a> that could brute force the puzzle in less than a minute.</p>
<img alt="My solver" class="align-center" src="/images/solver.gif" style="width: 50%;" />
<p>Emily finished <a class="reference external" href="https://github.com/xymostech/wood-puzzle/blob/master/src/Main.hs">her solver</a> around the same time and we were able to confirm our results. <strong>The hard side of the puzzle was unsolvable</strong>.</p>
<p>Clearly there was a very evil puzzle master in our ranks.</p>
<img alt="An evil kitten" class="align-center" src="/images/evil-kitty.gif" style="width: 50%;" />
<p><a class="reference external" href="http://jamie-wong.com/">Jamie Wong</a> readily admitted to bringing in the puzzle (though he didn't tell us where he got it). Despite the staggering proof to the contrary though, he was adamant that a solution existed. He said our solvers all shared a fatal flaw.</p>
<p>After a few hints, Emily and I did find the answer <a class="footnote-reference" href="#hard-solution" id="id3">[3]</a>. Which was good, because none of us had gotten any work done for a little while and we were starting to feel guilty.</p>
<table class="docutils footnote" frame="void" id="easy-solution" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>If you want to spoil it for yourself, here is <a class="reference external" href="/images/easy-solved.jpg">a picture of the solved easy side</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="such-coordinates" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Ben Eater decided to side-step the issue by drawing the shapes directly onto the screen. Cam Christensen came up with a coordinate system with two axes that formed a 60Â° angle and he convinced Emily Eisenberg to use the same system. Justin Helps used a screen-based coordinate system like Ben Eater, but tracked all three vertices of each triangle.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="hard-solution" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>You don't really want me to give you the answer do you? That would be boring.</td></tr>
</tbody>
</table>
</div>

    </div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        // Disqus
        var disqus_shortname = 'johncscom';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        // GA
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-51104787-1', 'johncs.com');
        ga('send', 'pageview');
    </script>
</body>
</html>
